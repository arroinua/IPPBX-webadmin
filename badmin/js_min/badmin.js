window.onerror=function(a,b,c){console.error('Error message: '+a+'\nURL: '+b+'\nLine number: '+c)};var PbxObject=PbxObject||{};PbxObject.frases={saved:{en:'All changes saved!',uk:'Всі зміни збережені!',ru:'Все изменения сохранены!'},timeout:{en:'Operation timeout',uk:'Таймаут операції',ru:'Таймаут операции'},error:{en:'An error has occured',uk:'Сталося помилка',ru:'Возникла ошибка'},uploaded:{en:'uploaded',uk:'завантажен',ru:'загружен'},created:{en:'created',uk:'створений',ru:'создан'},doDelete:{en:'Delete',uk:'Видалити',ru:'Удалить'}};$(document).ready(function(){init_page();setPageHeight()});function json_rpc(a,b){var c;if(b==null){c='{\"method\":\"'+a+'\", \"id\":'+1+'}'}else{c='{\"method\":\"'+a+'\", \"params\":{'+b+'}, \"id\":'+1+'}'}var d=new XMLHttpRequest();d.open("POST","/",false);d.setRequestHeader('Content-Type','application/json; charset=UTF-8');d.send(c);var e=JSON.parse(d.responseText);if(e.error!=undefined){if(e.error.code==404||e.error.code==406){return}}return e.result}function json_rpc_async(b,c,d){var e;if(c)e='{\"method\":\"'+b+'\", \"params\":{'+c+'}, \"id\":'+1+'}';else e='{\"method\":\"'+b+'\", \"id\":'+1+'}';var f=new XMLHttpRequest();f.open("POST","/",true);var g=setTimeout(function(){f.abort();notify_about('info',PbxObject.frases.timeout[PbxObject.lang]);show_content()},30000);f.onreadystatechange=function(){if(f.readyState==4){clearTimeout(g);if(f.status!=200){notify_about('error',PbxObject.frases.error[PbxObject.lang]);show_content()};if(f.response){var a=JSON.parse(f.response);if(a.error!=undefined){notify_about('error',a.error.message);show_content()}else if(a.result){if(d!=null){d(a.result)}}}}};f.setRequestHeader('Content-Type','application/json; charset=UTF-8');f.send(e)}function setPageHeight(){$('#pagecontent').css('min-height',function(){return $(window).height()})}function changeOnResize(a){if(PbxObject.smallScreen!==a){if(a){if($('#pagecontent').hasClass('squeezed-right')){$('#pagecontent').removeClass('squeezed-right')}if($('#pbxmenu').hasClass('squeezed-menu')){$('#pbxmenu').removeClass('squeezed-menu')}}else{if(!($('#pagecontent').hasClass('squeezed-right'))){$('#pagecontent').addClass('squeezed-right')}}PbxObject.smallScreen=a}}function init_page(){PbxObject.smallScreen=isSmallScreen();$(window).resize(function(){setPageHeight();changeOnResize(isSmallScreen())});if(!isSmallScreen()){$('#pagecontent').addClass('squeezed-right')}if($(window).width()>767&&$(window).width()<959){$('#pbxmenu').addClass('squeezed-menu');$('#pagecontent').removeClass('squeezed-right')}if(!location.hash.substring(1))location.hash='extensions';PbxObject.lang=window.localStorage.getItem('pbxLanguage');get_object();setTimeout(function(){set_listeners()},1000)}function set_listeners(){addEvent(window,'hashchange',get_object);$('.sidebar-toggle','#pagecontent').click(toggle_sidebar);$('.options-open','#pagecontent').click(open_options);$('.options-close','#pbxoptions').click(close_options);$('#pbxmenu li a').click(function(){var b=$(this).parent();var c=$(this).attr('data-kind');if(c&&!b.hasClass('active')){var d=document.createElement('ul');d.id='ul-'+c;var f=json_rpc('getObjects','\"kind\":\"'+c+'\"');var g=document.createElement('li');g.className='add-group-object';var a=document.createElement('a');if(c=='application'){var h=document.createElement('input');h.type="file";h.id="uploadapp";h.className="upload-custom";h.accept=".application";addEvent(h,'change',function(){upload('uploadapp')});g.appendChild(h);a.href='#';addEvent(a,'click',function(e){document.getElementById('uploadapp').click();if(e)e.preventDefault})}else{a.href='#'+c}a.innerHTML='<i class="glyphicon glyphicon-plus"></i><span>Add</span>';g.appendChild(a);d.appendChild(g);var i,gid,name,g,a,rem;for(i=0;i<f.length;i++){gid=f[i].oid;name=f[i].name;g=document.createElement('li');a=document.createElement('a');a.href='#'+c+'?'+gid;a.innerHTML=name;g.appendChild(a);d.appendChild(g)}$(this).siblings().remove('ul');b.append(d)}b.siblings('li.active').removeClass('active').children('ul:visible').slideUp('normal');b.addClass('active');var j=$(this).next();if((j.is('ul'))&&(j.is(':visible'))){b.removeClass('active');j.slideUp('normal')}if((j.is('ul'))&&(!j.is(':visible'))){j.slideDown('normal')}if(b.find('ul').children().length==0){return true}else{return false}})}function get_object(a){var b=location.hash.substring(1),lang=PbxObject.lang,callback,fn;if(b.substring(b.indexOf('?')+1)===PbxObject.oid)return;if(b!=''){show_loading_panel();if(PbxObject.updext)clearInterval(PbxObject.updext);var c=document.getElementById('el-loaded-content');if(c)c.parentNode.removeChild(c);var d=document.getElementById('el-extension');if(d)d.parentNode.removeChild(d);var e=b;var f=b.indexOf('?');if(f!=-1){e=b.substring(f+1);b=b.substring(0,f)}if(b!='extensions'&&b!='trunk'&&b!='application'&&b!='cli'&&b!='routes'&&b!='timer'){b='bgroup'}callback='load_'+b;fn=window[callback];$("#dcontainer").load('/badmin/'+lang+'/'+b+'.html',function(){if(b=='extensions'){json_rpc_async('getExtensions',null,fn)}else{json_rpc_async('getObject','\"oid\":\"'+e+'\"',fn)}$('#dcontainer').scrollTop(0);$('.squeezed-menu > ul').children('li.active').removeClass('active').children('ul:visible').slideUp('normal')})}}function filter_table(a){var a=a||window.event;var b,val,row,input=a.target,tid=input.getAttribute('data-table'),table=document.getElementById(tid);val=input.value.toLowerCase();for(var i=1;i<table.rows.length;i++){row=table.rows[i];b=row.textContent.toLowerCase();row.style.display=b.indexOf(val)===-1?'none':'table-row'}}function set_page(){var a=PbxObject.kind;if(a!='extensions'&&a!='trunk'&&a!='application'&&a!='cli'&&a!='routes'&&a!='timer'){a='bgroup'}var b=document.getElementsByClassName('delall'),trow=document.getElementsByClassName('transrow'),clirow=document.getElementsByClassName('clirow'),trow=document.getElementsByClassName('routerow'),approw=document.getElementsByClassName('approw'),so=document.getElementById('el-set-object'),delobj=document.getElementById('el-delete-object'),handler='set_'+a,fn=window[handler];if(b.length){for(var i=0;i<b.length;i++){addEvent(b[i],'change',check_all_rows)}}if(trow.length){for(i=0;i<trow.length;i++){addEvent(trow[i],'click',append_transform)}}if(clirow.length){for(i=0;i<clirow.length;i++){addEvent(clirow[i],'click',add_cli_row)}}if(trow.length){for(i=0;i<trow.length;i++){addEvent(trow[i],'click',add_route)}}if(approw.length){for(i=0;i<approw.length;i++){addEvent(approw[i],'click',add_app_row)}}if(so){so.onclick=function(){fn()}}if(delobj){if(PbxObject.name){delobj.onclick=function(e){delete_object(e,PbxObject.name,PbxObject.kind,PbxObject.oid)}}else delobj.setAttribute('disabled','disabled')}if(a=='hunting'||a=='icd'||a=='unit'||a=='routes'){var c=document.getElementsByClassName('el-sortable');for(var i=0;i<c.length;i++){new Sortable(c[i])}}$('div.panel-header').click(toggle_panel)}function toggle_sidebar(e){$('#pagecontent').toggleClass('squeezed-right');if(!isSmallScreen())toggle_menu();if(e)e.preventDefault()}function toggle_menu(){$('#pbxmenu').toggleClass('squeezed-menu')}function open_options(e){get_pbx_options();$(this).off('click');$(this).addClass('spinner');$('#pbxoptions').addClass('top-layer');if(e)e.preventDefault()}function close_options(e){$('.options-open','#pagecontent').click(open_options);$('#pagecontent').removeClass('pushed-left');$('#el-slidemenu').removeClass('hide-menu');setTimeout(function(){$('#pbxoptions').removeClass('top-layer');$('#el-options-content').remove()},500);if(e)e.preventDefault()}function toggle_panel(){$(this).parent().toggleClass('minimized');var a=this.parentNode.children[1];$(a).slideToggle()}function show_loading_panel(){if(document.getElementById('el-loading'))return;var a=document.createElement('div');a.id='el-loading';a.className='el-loading-panel ';var b=document.createElement('img');b.src='/badmin/images/sprites_white.png';b.className='loader';var c=document.getElementById('pagecontainer');a.appendChild(b);c.appendChild(a)}function show_content(){var a=document.getElementById('el-loading');if(a)a.parentNode.removeChild(a);if(isSmallScreen()&&$('#pagecontent').hasClass('squeezed-right')){$('#pagecontent').removeClass('squeezed-right')}}function switch_tab(a){var b=document.getElementById(a);var c=b.parentNode.parentNode;var d=c.children;for(var i=0;i<d.length;i++){if(d[i].children[0].id!=a){d[i].style.display='none'}else d[i].style.display=''}}function switch_options_tab(a){var b=document.getElementById(a),parent=b.parentNode,childs=parent.children;for(var i=1;i<childs.length;i++){if(childs[i].id!=a){childs[i].style.display='none'}else childs[i].style.display=''}}function notify_about(a,b){var c,ico,cls,body=document.getElementsByTagName('body')[0];switch(a){case'success':ico='<span class="glyphicon glyphicon-ok"></span>';cls='el-notifier-ok';break;case'error':ico='<span class="glyphicon glyphicon-remove"></span>';cls='el-notifier-error';break;default:ico='<span class="glyphicon glyphicon-exclamation-sign"></span>';cls='el-notifier-info'}var d=document.createElement('div');d.className='el-notifier '+cls;d.innerHTML=b+' '+ico;body.appendChild(d);c=setTimeout(function(){body.removeChild(d)},5000)}function append_transform(e,a,b){var c=e||window.event;if(c)var d=c.target||c.srcElement;if(d&&d.nodeType==3){d=d.parentNode}var f,tbody;if(a){f=document.getElementById(a)}else{var g=d.parentNode;while(g!=null){if(g.nodeName.toLowerCase()=='table'){f=document.getElementById(g.id);break}g=g.parentNode}}tbody=f.getElementsByTagName('tbody')[0];var h=document.createElement('tr');var i=document.createElement('td');h.appendChild(i);var j=document.createElement('div');j.className='form-group';var k=document.createElement('input');k.className='form-control';k.setAttribute('type','text');k.setAttribute('name','number');if(b!=null){k.setAttribute('value',b.number)}j.appendChild(k);i.appendChild(j);i=document.createElement('td');h.appendChild(i);var j=document.createElement('div');j.className='form-group';k=document.createElement('input');k.setAttribute('type','checkbox');k.setAttribute('name','strip');if(b!=null){k.checked=b.strip}i.setAttribute('align','center');j.appendChild(k);i.appendChild(j);i=document.createElement('td');h.appendChild(i);var j=document.createElement('div');j.className='form-group';k=document.createElement('input');k.className='form-control';k.setAttribute('type','text');k.setAttribute('name','prefix');if(b!=null){k.setAttribute('value',b.prefix)}j.appendChild(k);i.appendChild(j);i=document.createElement('td');var j=document.createElement('div');j.className='form-group';k=document.createElement('input');k.setAttribute('type','checkbox');k.className='delall';addEvent(k,'change',function(){change_handler(f.id)});j.appendChild(k);i.appendChild(j);h.appendChild(i);tbody.appendChild(h)}function clear_transforms(a){var i,j,table;for(i=0;i<a.length;i++){table=document.getElementById(a[i]);for(j=table.rows.length-1;j>1;j--){table.deleteRow(j)}}}function delete_rows(e){var e=e||window.event,targ=e.target||e.srcElement;if(targ&&targ.nodeType==3){targ=targ.parentNode}var a,c;var b=targ.parentNode;while(b!=null){if(b.nodeName.toLowerCase()=='table'){a=document.getElementById(b.id);break}b=b.parentNode}var c=a.getElementsByTagName('tbody')[0],delall=a.getElementsByClassName('delall')[0];var i=c.children.length;while(i--){var d=c.children[i];var f=d.getElementsByClassName('delall')[0];if(f.checked)c.removeChild(d)}if(delall.checked)delall.checked=false;change_handler(b.id)}function encode_transforms(a){var b=document.getElementById(a).getElementsByTagName('tbody')[0];var c='';var i=b.children.length;while(i--){var d=b.children[i];var e=d.getElementsByTagName('input');var l=e.length;c+='{';while(l--){if(e[l].name=='number'){c+='\"number\":\"'+e[l].value+'\",'}else if(e[l].name=='strip'){c+='\"strip\":'+e[l].checked+','}else if(e[l].name=='prefix'){c+='\"prefix\":\"'+e[l].value+'\",'}}c+='},'}return c}function check_all_rows(e){var e=e||window.event;var a=e.target||e.srcElement;if(a.nodeType==3){a=a.parentNode}var b=a.parentNode;while(b!=null){if(b.nodeName.toLowerCase()=='table'){var c=b.id;break}b=b.parentNode}var d=document.getElementById(c),chk=d.getElementsByClassName(this.className),ischk=this.checked;for(var i=0;i<chk.length;i++){chk[i].checked=ischk}change_handler(c)}function change_handler(a){var c,i,handler,cl,o=0;if(a=='rtable'){handler=add_route;cl='routerow'}else if(a=='clinumbers'){handler=add_cli_row;cl='clirow'}else if(a=='appvariables'){handler=add_app_row;cl='approw'}else{handler=append_transform;cl='transrow'}var b=document.getElementById(a),th=b.getElementsByClassName(cl)[0],ico=th.firstChild,chk=b.getElementsByClassName('delall');for(i=0;i<chk.length;i++){if(chk[i].checked)o+=1}if(ico.className.match(/(?:^|\s)glyphicon-plus(?!\S)/g)){c='glyphicon-minus';removeEvent(th,'click',handler);addEvent(th,'click',delete_rows);th.style.color='#d43f3a'}else{if(o>0){return}else{c='glyphicon-plus';removeEvent(th,'click',delete_rows);addEvent(th,'click',handler);th.style.color=''}}ico.className='glyphicon '+c}function set_new_object(){var b=document.getElementById('el-loading');if(b)b.parentNode.removeChild(b);var c=PbxObject.kind,oname=PbxObject.name,ooid=PbxObject.oid,ul=document.getElementById('ul-'+c);location.hash=c+'?'+ooid;if(ul){var d=document.createElement('li'),a=document.createElement('a'),rem=document.createElement('a');a.href='#'+c+'?'+ooid;a.innerHTML=oname;d.appendChild(a);ul.appendChild(d)}notify_about('success',oname+' '+PbxObject.frases.created[PbxObject.lang])}function set_object_success(){var a=document.getElementById('el-loading');if(a)a.parentNode.removeChild(a);notify_about('success',PbxObject.frases.saved[PbxObject.lang])}function set_options_success(){var i,newpath='',parts=window.location.pathname.split('/');for(i=0;i<parts.length;i++){if(parts[i]==='en'||parts[i]==='uk'||parts[i]==='ru'){parts[i]=PbxObject.lang}newpath+='/';newpath+=parts[i]}var a=window.location.protocol+"//"+window.location.host+newpath.substring(1);window.location.href=a}function delete_object(e,a,b,d){e.preventDefault();var c=confirm(PbxObject.frases.doDelete[PbxObject.lang]+' '+a+'?');if(c){var f=document.getElementById('ul-'+b);if(f){var g,href;for(var i=0;i<f.children.length;i++){g=f.children[i];href=g.children[0].href;if(href&&href.substring(href.indexOf('?')+1)==d){f.removeChild(g)}}}json_rpc('deleteObject','\"oid\":\"'+d+'\"');if(d===PbxObject.oid)window.location.hash='extensions'}else{return false}}function delete_extension(){var a=this.parentNode.parentNode,ext=a.firstChild.firstChild,group=a.children[2].firstChild,msg,c;switch(PbxObject.lang){case'en':msg='Delete '+ext.textContent+' from '+group.textContent+'?';break;case'uk':msg='Видалити '+ext.textContent+' з '+group.textContent+'?';break;case'ru':msg='Удалить '+ext.textContent+' из '+group.textContent+'?';break};c=confirm(msg);if(c){removeEvent(ext,'click',get_extension);var b=ext.getAttribute('data-oid');json_rpc_async('deleteObject','\"oid\":\"'+b+'\"',null);update_extansions()}else{return false}}function customize_upload(a,b){var c=document.getElementById(a),uplparent=c.parentNode,uplbtn=document.createElement('button'),uplname=document.createElement('span');if(b!==null)uplname.innerHTML=' '+b;uplbtn.type='button';uplbtn.className='btn btn-default btn-sm';uplbtn.innerHTML='Upload';uplbtn.onclick=function(){c.click()};uplparent.insertBefore(uplbtn,c);uplparent.insertBefore(uplname,c);c.onchange=function(){if(this.files.length)uplname.innerHTML=' '+this.files[0].name;else uplname.innerHTML=' '}}function b(a){var b=document.getElementById(a);var c=b.files;if(c.length==0){return false}var d=c[0];var e=new XMLHttpRequest();var f=setTimeout(function(){e.abort();notify_about('info',PbxObject.frases.timeout[PbxObject.lang])},30000);e.onreadystatechange=function(){if(e.readyState==4){clearTimeout(f);if(e.status!=200){notify_about('error',PbxObject.frases.error[PbxObject.lang])}else{if(b=='uploadapp'){notify_about('success',d.name+' '+PbxObject.frases.uploaded[PbxObject.lang])}}}};e.open("PUT","/",true);e.setRequestHeader("X-File-Name",d.name);e.setRequestHeader("X-File-Size",d.size);e.send(d)}function get_object_link(a){var b=json_rpc('getObject','\"oid\":\"'+a+'\"');location.hash=b.kind+'?'+a}function get_pbx_options(){var a='/badmin/js/options.js';$.getScript(a,function(){json_rpc_async('getPbxOptions',null,load_pbx_options)})}function isSmallScreen(){return $(window).width()<768}function addEvent(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,c)}function removeEvent(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);else if(a.detachEvent)a.detachEvent("on"+b,c)}function load_bgroup(a){switch_tab(a.kind);var i,cl,enabled,d=document,kind=a.kind,options=d.getElementById('options');PbxObject.oid=a.oid;PbxObject.kind=kind;PbxObject.name=a.name;if(kind=='conference'){var b=["OFF","320x240","352x288","640x360","640x480","704x576","1024x768","1280x720","1920x1080"];PbxObject.videomax=a.maxvideomode}enabled=document.getElementById('enabled');if(enabled)enabled.checked=a.enabled;fill_list_items('available',a.available);fill_list_items('members',a.members);d.getElementById('extensions').parentNode.style.display='';if(kind=='icd'||kind=='conference'){if(kind=='icd'){cl='conf-options'}else cl='icd-options';var p=options.getElementsByClassName(cl);i=p.length;while(i--){var c=p[i].parentNode;c.parentNode.removeChild(c)}var e=d.getElementById('profile');e.parentNode.removeChild(e)}else{options.parentNode.removeChild(options)}if(a.name){d.getElementById('objname').value=a.name}if(a.options){if(kind=='equipment'){var f=a.options.kind||'ipphones';d.getElementById(f).checked=true;if(a.options.kind=='gateway'){d.getElementById('regname').value=a.options.regname||'';d.getElementById('regpass').value=a.options.regpass||''}else if(a.options.kind=='trunk'){d.getElementById('username').value=a.options.regname||'';d.getElementById('password').value=a.options.regpass||'';d.getElementById('address').value=a.options.address||''}d.getElementById('phonelines').value=a.options.phonelines||'1';if(a.options.starflash!=undefined){d.getElementById('starflash').checked=a.options.starflash}}else if(kind=='unit'){d.getElementById("groupno1").value=a.options.groupno||'';d.getElementById("timeout1").value=a.options.timeout||'';if(a.options.huntmode)d.getElementById("huntmode1").selectedIndex=a.options.huntmode;if(a.options.huntfwd)d.getElementById("huntfwd1").checked=a.options.huntfwd}else if(kind=='hunting'){if(a.options.timeout)d.getElementById("timeout2").value=a.options.timeout;if(a.options.huntmode)d.getElementById("huntmode2").selectedIndex=a.options.huntmode;if(a.options.huntfwd)d.getElementById("huntfwd2").checked=a.options.huntfwd}else if(kind=='pickup'){d.getElementById("groupno2").value=a.options.groupno||''}else if(kind=='icd'){d.getElementById("groupno").value=a.options.groupno||'';d.getElementById("maxlines").value=a.options.maxlines||'';d.getElementById("priority").value=a.options.priority||'';d.getElementById("canpickup").checked=a.options.canpickup;d.getElementById("autologin").checked=a.options.autologin;d.getElementById("method").selectedIndex=a.options.method;d.getElementById("natimeout").value=a.options.natimeout||'';d.getElementById("resumetime").value=a.options.resumetime||'';d.getElementById("queuelen").value=a.options.queuelen||'';d.getElementById("maxqwait").value=a.options.maxqwait||'';d.getElementById("overflowredirect").value=a.options.overflowredirect||'';d.getElementById("overtimeredirect").value=a.options.overtimeredirect||'';d.getElementById("indicationmode").value=a.options.indicationmode||'';d.getElementById("indicationtime").value=a.options.indicationtime||'';customize_upload('greeting',a.options.greeting)}else if(kind=='conference'){customize_upload('onhold2',null);customize_upload('greeting2',null);d.getElementById("dialuptt").value=a.options.dialtimeout||'';d.getElementById("autoredial").checked=a.options.autoredial;d.getElementById("confrecord").checked=a.options.recording;var g=d.getElementById("playgreet");g.checked=a.options.greeting;if(g.checked)g.checked=a.options.greetingfile?true:false;var h=d.getElementById("conf-init-mode").getElementsByClassName('init-mode');for(i=0;i<h.length;i++){if(a.options.initmode==h[i].value){h[i].checked=true}}var j=d.getElementById("videoform");for(i=0;i<b.length;i++){var k=d.createElement('option');k.value=b[i];k.innerHTML=b[i];j.appendChild(k);if(b[i]==a.options.videomode){j.selectedIndex=i}if(b[i]==a.options.maxvideomode){break}}}}if(a.profile!=undefined){d.getElementById('hold').checked=a.profile.hold;d.getElementById('forwarding').checked=a.profile.forwarding;d.getElementById('callpickup').checked=a.profile.callpickup;d.getElementById('dndover').checked=a.profile.dndover;d.getElementById('busyover').checked=a.profile.busyover;d.getElementById('monitor').checked=a.profile.monitor;d.getElementById('dnd').checked=a.profile.dnd;d.getElementById('clir').checked=a.profile.clir;d.getElementById('pickupdeny').checked=a.profile.pickupdeny;d.getElementById('busyoverdeny').checked=a.profile.busyoverdeny;d.getElementById('monitordeny').checked=a.profile.monitordeny;d.getElementById('callwaiting').checked=a.profile.callwaiting;d.getElementById('outcallbarring').checked=a.profile.outcallbarring;d.getElementById('costroutebarring').checked=a.profile.costroutebarring;d.getElementById('hold').checked=a.profile.hold;var l=a.profile.bnumbertransforms;if(l.length!=0){for(i=0;i<l.length;i++){append_transform(null,'transforms',l[i])}}else{append_transform(null,'transforms')}}show_content();set_page()}function set_bgroup(){var d=document,jprms,name=d.getElementById('objname').value;if(name)jprms='"name":"'+name+'",';else{alert('Object name must be filled');return false}show_loading_panel();var a;if(PbxObject.name){a=set_object_success}else{PbxObject.name=name;a=set_new_object}var b=PbxObject.oid;if(b)jprms+='"oid":"'+b+'",';var c=PbxObject.kind;if(c)jprms+='"kind":"'+c+'",';jprms+='\"enabled\":'+document.getElementById('enabled').checked+',';var e=d.getElementById('members');if(e){jprms+='"members":[';for(var i=0;i<e.children.length;i++){jprms+='"'+e.children[i].innerHTML+'",'}jprms+='],'}var f=d.getElementById('profile');if(f){jprms+='"profile":{';if(d.getElementById("hold")!=null){jprms+='"hold":'+d.getElementById("hold").checked+","}if(d.getElementById("forwarding")!=null){jprms+='"forwarding":'+d.getElementById("forwarding").checked+","}if(d.getElementById("callpickup")!=null){jprms+='"callpickup":'+d.getElementById("callpickup").checked+","}if(d.getElementById("dndover")!=null){jprms+='"dndover":'+d.getElementById("dndover").checked+","}if(d.getElementById("busyover")!=null){jprms+='"busyover":'+d.getElementById("busyover").checked+","}if(d.getElementById("monitor")!=null){jprms+='"monitor":'+d.getElementById("monitor").checked+","}if(d.getElementById("dnd")!=null){jprms+='"dnd":'+d.getElementById("dnd").checked+","}if(d.getElementById("clir")!=null){jprms+='"clir":'+d.getElementById("clir").checked+","}if(d.getElementById("callwaiting")!=null){jprms+='"callwaiting":'+d.getElementById("callwaiting").checked+","}if(d.getElementById("pickupdeny")!=null){jprms+='"pickupdeny":'+d.getElementById("pickupdeny").checked+","}if(d.getElementById("monitordeny")!=null){jprms+='"monitordeny":'+d.getElementById("monitordeny").checked+","}if(d.getElementById("busyoverdeny")!=null){jprms+='"busyoverdeny":'+d.getElementById("busyoverdeny").checked+","}if(d.getElementById("recording")!=null){jprms+='"recording":'+d.getElementById("recording").checked+","}if(d.getElementById("voicemail")!=null){jprms+='"voicemail":'+d.getElementById("voicemail").checked+","}if(d.getElementById("outcallbarring")!=null){jprms+='"outcallbarring":'+d.getElementById("outcallbarring").checked+","}if(d.getElementById("costroutebarring")!=null){jprms+='"costroutebarring":'+d.getElementById("costroutebarring").checked+","}var g=d.getElementById('transforms').getElementsByTagName('tbody')[0];if(g){jprms+='"bnumbertransforms":[';jprms+=encode_transforms('transforms');jprms+=']'}jprms+='},'}jprms+='"options":{';if(c=='equipment'){if(d.getElementById("ipphones").checked){jprms+='"kind":"ipphones",'}else if(d.getElementById("gateway").checked){jprms+='"kind":"gateway",';jprms+='"regname":"'+d.getElementById("regname").value+'",';jprms+='"regpass":"'+d.getElementById("regpass").value+'",'}else if(d.getElementById("trunk").checked){jprms+='"kind":"trunk",';jprms+='"address":"'+d.getElementById("address").value+'",';jprms+='"regname":"'+d.getElementById("username").value+'",';jprms+='"regpass":"'+d.getElementById("password").value+'",'}if(d.getElementById("phonelines")!=null){jprms+='"phonelines":'+d.getElementById("phonelines").value+','}if(d.getElementById("starflash")!=null){jprms+='"starflash":'+d.getElementById("starflash").checked+','}}else if(c=='unit'){jprms+='"groupno":"'+d.getElementById("groupno1").value+'",';jprms+='"timeout":'+d.getElementById("timeout1").value+',';jprms+='"huntmode":'+d.getElementById("huntmode1").value+',';jprms+='"huntfwd":'+d.getElementById("huntfwd1").checked+','}else if(c=='hunting'){jprms+='"timeout":'+d.getElementById("timeout2").value+',';jprms+='"huntmode":'+d.getElementById("huntmode2").value+',';jprms+='"huntfwd":'+d.getElementById("huntfwd2").checked+','}else if(c=='pickup'){jprms+='"groupno":"'+d.getElementById("groupno2").value+'",'}else if(c=='icd'){jprms+='"groupno":"'+d.getElementById("groupno").value+'",';jprms+='"maxlines":'+d.getElementById("maxlines").value+',';jprms+='"priority":'+d.getElementById("priority").value+',';jprms+='"canpickup":'+d.getElementById("canpickup").checked+',';jprms+='"autologin":'+d.getElementById("autologin").checked+',';jprms+='"method":'+d.getElementById("method").value+',';jprms+='"natimeout":'+d.getElementById("natimeout").value+',';jprms+='"resumetime":'+d.getElementById("resumetime").value+',';jprms+='"queuelen":'+d.getElementById("queuelen").value+',';jprms+='"overflowredirect":"'+d.getElementById("overflowredirect").value+'",';jprms+='"maxqwait":'+d.getElementById("maxqwait").value+',';jprms+='"overtimeredirect":"'+d.getElementById("overtimeredirect").value+'",';jprms+='"indicationmode":'+d.getElementById("indicationmode").value+',';jprms+='"indicationtime":'+d.getElementById("indicationtime").value+',';var h=document.getElementById("greeting");if(h.value){jprms+='"greeting":"'+h.files[0].name+'",';upload('greeting')}}else if(c=='conference'){jprms+='"dialtimeout":'+d.getElementById("dialuptt").value+',';jprms+='"autoredial":'+d.getElementById("autoredial").checked+',';jprms+='"recording":'+d.getElementById("confrecord").checked+',';jprms+='"videomode":"'+d.getElementById("videoform").value+'",';var j=d.getElementById("playgreet");jprms+='"greeting\":'+j.checked+',';h=document.getElementById("greeting2");if(j.checked&&h.value){jprms+='"greetingfile":"'+h.files[0].name+'",';upload('greeting2')}var k=d.getElementById("conf-init-mode").getElementsByClassName('init-mode');for(i=0;i<k.length;i++){if(k[i].checked){jprms+='"initmode":'+k[i].value+',';if(k[i].value==2){h=document.getElementById("onhold2");if(h.value){jprms+='"onholdfile":"'+h.files[0].name+'",';upload('onhold2')}}}}}jprms+='}';json_rpc_async('setObject',jprms,a)}function fill_list_items(a,b){if(a=='available'||(PbxObject.kind!='hunting'&&PbxObject.kind!='icd'&&PbxObject.kind!='unit')){b.sort()}var c=document.getElementById(a);for(var i=0;i<b.length;i++){var d=document.createElement('li');addEvent(d,'click',move_list_item);d.setAttribute('data-value',b[i]);d.innerHTML=b[i];c.appendChild(d)}}function move_list_item(){var a=this;var b=a.parentNode;if(b.id=='available'){b.removeChild(a);document.getElementById('members').appendChild(a)}else{b.removeChild(a);document.getElementById('available').appendChild(a)}}function load_application(a){PbxObject.oid=a.oid;PbxObject.name=a.name;if(a.name){document.getElementById('objname').value=a.name}if(a.enabled)document.getElementById('enabled').checked=a.enabled;if(a.debug)document.getElementById('debug').checked=a.debug;if(a.status)document.getElementById('status').innerHTML=a.status;if(a.dbconnection){var b=a.dbconnection;if(b.driver=='sun.jdbc.odbc.JdbcOdbcDriver'){document.getElementById('odbc').checked=true;if(b.url)document.getElementById('odbcurl').value=b.url}else if(b.driver){document.getElementById('jdbc').checked=true;document.getElementById('jdbcdriver').value=b.driver;if(b.url)document.getElementById('jdbcurl').value=b.url}if(b.schema)document.getElementById('dbowner').value=b.schema;if(b.username)document.getElementById('dbuser').value=b.username;if(b.password)document.getElementById('dbpass').value=b.password}var c=a.parameters;if(c.length){for(var i=0;i<c.length;i++){add_app_row(c[i])}}else{add_app_row()}show_content();set_page()}function set_application(){show_loading_panel();if(PbxObject.oid)a+='"oid":"'+PbxObject.oid+'",';var a='\"name\":\"'+document.getElementById('objname').value+'\",';a+='"enabled":'+document.getElementById('enabled').checked+',';if(PbxObject.oid)a+='\"oid\":\"'+PbxObject.oid+'\",';var b=document.getElementById('appvariables').getElementsByTagName('tbody')[0];a+='\"parameters\":[';var i,j;for(i=0;i<b.children.length;i++){var c=b.children[i];var d=c.getElementsByTagName('input');var e='';for(j=0;j<d.length;j++){if(d[j].name=='variable'){e+='"key":"'+d[j].value+'",'}else if(d[j].name=='value'){e+='"value":"'+d[j].value+'",'}else continue}if(e!=''){a+='{'+e+'},'}}a+='],';a+='"debug":'+document.getElementById('debug').checked+',';a+='"dbconnection":{';var f,url;if(document.getElementById('odbc').checked){f='sun.jdbc.odbc.JdbcOdbcDriver';url=document.getElementById('odbcurl').value}else{f=document.getElementById('jdbcdriver').value;url=document.getElementById('jdbcurl').value}a+='"driver":"'+f+'",';a+='"url":"'+url+'",';if(document.getElementById('dbowner'))a+='"schema":"'+document.getElementById('dbowner').value+'",';if(document.getElementById('dbuser'))a+='"username":"'+document.getElementById('dbuser').value+'",';if(document.getElementById('dbpass'))a+='"password":"'+document.getElementById('dbpass').value+'",';a+='},';json_rpc_async('setObject',a,set_object_success)}function add_app_row(a){var b=document.getElementById('appvariables').getElementsByTagName('tbody')[0];var c=document.createElement('tr');var d=document.createElement('td');var e=document.createElement('div');e.className='form-group';var f=document.createElement('input');f.className='form-control';f.setAttribute('type','text');f.setAttribute('name','variable');f.setAttribute('disabled','disabled');if(a&&a.key)f.value=a.key;e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);d=document.createElement('td');e=document.createElement('div');e.className='form-group';f=document.createElement('input');f.className='form-control';f.setAttribute('name','value');if(a&&a.value)f.value=a.value;e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);b.appendChild(c)}function load_cli(a){PbxObject.oid=a.oid;PbxObject.name=a.name;PbxObject.kind='cli';if(a.name){document.getElementById('objname').value=a.name}document.getElementById('enabled').checked=a.enabled;var b=a.bnumbertransforms;if(b.length){for(var i=0;i<b.length;i++){append_transform(null,'transforms1',b[i])}}else{append_transform(null,'transforms1')}var c=a.numbers;if(c.length){for(i=0;i<c.length;i++){add_cli_row(c[i])}}else{add_cli_row()}show_content();set_page()}function set_cli(){var a=document.getElementById('objname').value;if(a)var b='\"name\":\"'+a+'\",';else{alert('Object name must be filled');return false}show_loading_panel();var c;if(PbxObject.name){c=set_object_success}else{PbxObject.name=a;c=set_new_object}if(PbxObject.oid)b+='\"oid\":\"'+PbxObject.oid+'\",';b+='\"kind\":\"cligroup\",';b+='\"enabled\":'+document.getElementById('enabled').checked+',';b+='\"bnumbertransforms\":[';b+=encode_transforms('transforms1');b+='],';b+='\"numbers\":[';var i,tbody=document.getElementById('clinumbers').getElementsByTagName('tbody')[0];for(i=0;i<tbody.children.length;i++){var d=tbody.children[i];var e='';var f=d.getElementsByTagName('input')[0];if(f&&f.name=='number'){e+='"number":"'+f.value+'",'}var g=d.getElementsByTagName('textarea')[0];if(g&&g.name=='description'){e+='"description":"'+g.value+'",'}if(e!=''){b+='{'+e+'},'}}b+=']';json_rpc_async('setObject',b,c)}function add_cli_row(a){var b=document.getElementById('clinumbers').getElementsByTagName('tbody')[0];var c=document.createElement('tr');var d=document.createElement('td');var e=document.createElement('div');e.className='form-group';var f=document.createElement('input');f.className='form-control';f.setAttribute('type','text');f.setAttribute('name','number');if(a&&a.number)f.value=a.number;e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);d=document.createElement('td');e=document.createElement('div');e.className='form-group';f=document.createElement('textarea');f.className='form-control y-resizable';f.setAttribute('rows','3');f.setAttribute('name','description');if(a&&a.description)f.value=a.description;e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);d=document.createElement('td');e=document.createElement('div');e.className='form-group';f=document.createElement('input');f.setAttribute('type','checkbox');f.className='delall';addEvent(f,'change',function(){change_handler('clinumbers')});e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c)}function load_extensions(b){var c,cell,a,button,state,lrow,status,table=document.getElementById('extensions').getElementsByTagName('tbody')[0];for(var i=0;i<b.length;i++){lrow=table.rows.length;c=table.insertRow(lrow);c.setAttribute('data-ext',b[i].ext);state=b[i].state;if(state==0){status='Registered';c.className='success'}else if(state==3){status='Connected';c.className='connected'}else if(state==6){status='Forwarding';c.className='warning'}else if(state==5){status='';c.className=''}else if(state==4){status='Do not disturb';c.className='danger'}else if(state==1||state==2){status=state==1?'Dialing':'Ringing';c.className='info'}else{status='';c.className='active'}cell=c.insertCell(0);a=document.createElement('a');if(b[i].oid){a.href='#';a.setAttribute('data-oid',b[i].oid);addEvent(a,'click',get_extension)}a.innerHTML=b[i].ext;cell.appendChild(a);cell=c.insertCell(1);cell.innerHTML=b[i].name||"";cell=c.insertCell(2);cell.innerHTML=b[i].group;cell=c.insertCell(3);cell.innerHTML=b[i].reg;cell=c.insertCell(4);cell.innerHTML=b[i].kind;cell=c.insertCell(5);if(status)cell.innerHTML=status;cell=c.insertCell(6);button=document.createElement('button');button.className='btn btn-danger btn-sm';button.innerHTML='<i class="glyphicon glyphicon-trash"></i>';if(state==-1){button.setAttribute('disabled','true')}else{addEvent(button,'click',delete_extension)}cell.appendChild(button)}var d=document.getElementById('extrefresh');d.onclick=function(){update_extansions()};var e=document.getElementById('extrepeat');e.onclick=function(){set_update_interval()};var f=document.getElementsByClassName('el-search');if(f.length){for(i=0;i<f.length;i++){f[i].oninput=function(){filter_table()}}}var g=$('#el-extension');$(g).insertBefore('#pagecontainer');show_content()}function get_extension(a){var a=a||window.event;var b=this.getAttribute('data-oid');if(b){show_loading_panel();json_rpc_async('getObject','\"oid\":\"'+b+'\"',load_extension)}a.preventDefault()}function load_extension(a){var d=document,groupid=a.groupid,kind=a.kind=='user'?'users':'unit';PbxObject.kind=kind;PbxObject.oid=a.oid;document.getElementById('el-extension-num').innerHTML='Extension '+a.number;var b=document.getElementById("extgroup");for(var i=0;i<=b.options.length;i++){b.remove(b.selectedIndex[i])}if(groupid){b.disabled=false;fill_group_choice(kind,groupid)}else{b.disabled=true}if(kind=='users'){d.getElementById('followme').disabled=false;d.getElementById('followme').value=a.followme}else{d.getElementById('followme').disabled=true;d.getElementById('followme').value=''}d.getElementById('extname').value=a.name;d.getElementById('extpin').value=a.pin;d.getElementById('extlogin').value=a.login;d.getElementById('extpassword').value=a.password;d.getElementById('extdisplay').value=a.display;if(a.features){d.getElementById('extfeatures').style.display='';if(a.features.fwdall!=undefined){d.getElementById('forwarding').style.display='';d.getElementById('fwdall').checked=a.features.fwdall;d.getElementById('fwdallnumber').value=a.features.fwdallnumber;d.getElementById('fwdnreg').checked=a.features.fwdnreg;d.getElementById('fwdnregnumber').value=a.features.fwdnregnumber;d.getElementById('fwdbusy').checked=a.features.fwdbusy;d.getElementById('fwdbusynumber').value=a.features.fwdbusynumber;d.getElementById('fwdnans').checked=a.features.fwdnans;d.getElementById('fwdnansnumber').value=a.features.fwdnansnumber;d.getElementById('fwdtimeout').value=a.features.fwdtimeout}else{d.getElementById('forwarding').style.display='none'}if(a.features.dnd!=undefined){d.getElementById('dnd').checked=a.features.dnd}else{d.getElementById('dnd').setAttribute('disabled','');d.getElementById('dnd').checked=false}if(a.features.clir!=undefined){d.getElementById('clir').checked=a.features.clir}else{d.getElementById('clir').setAttribute('disabled','');d.getElementById('clir').checked=false}if(a.features.callwaiting!=undefined){d.getElementById('callwaiting').checked=a.features.callwaiting}else{d.getElementById('callwaiting').setAttribute('disabled','');d.getElementById('callwaiting').checked=false}if(a.features.pickupdeny!=undefined){d.getElementById('pickupdeny').checked=a.features.pickupdeny}else{d.getElementById('pickupdeny').setAttribute('disabled','');d.getElementById('pickupdeny').checked=false}if(a.features.monitordeny!=undefined){d.getElementById('monitordeny').checked=a.features.monitordeny}else{d.getElementById('monitordeny').setAttribute('disabled','');d.getElementById('monitordeny').checked=false}if(a.features.busyoverdeny!=undefined){d.getElementById('busyoverdeny').checked=a.features.busyoverdeny}else{d.getElementById('busyoverdeny').setAttribute('disabled','');d.getElementById('busyoverdeny').checked=false}if(a.features.voicemail!=undefined){d.getElementById('voicemail').checked=a.features.voicemail}else{d.getElementById('voicemail').setAttribute('disabled','');d.getElementById('voicemail').checked=false}if(a.features.recording!=undefined){d.getElementById('recording').checked=a.features.recording}else{d.getElementById('recording').setAttribute('disabled','');d.getElementById('recording').checked=false}if(a.features.lock!=undefined){d.getElementById('plock').checked=a.features.lock}else{d.getElementById('plock').setAttribute('disabled','');d.getElementById('plock').checked=false}}else{d.getElementById('extfeatures').style.display='none'}$('#el-extension').modal();show_content();d.getElementById('el-set-object').onclick=function(){set_extension()}}function set_extension(a){var a=a||window.event;a.preventDefault();var d=document,oid=PbxObject.oid,kind=PbxObject.kind;var b='\"oid\":\"'+oid+'\",';var c=d.getElementById("extgroup");if(c.options.length)var e=c.options[c.selectedIndex].value;if(e)b+='\"groupid\":\"'+e+'\",';if(kind=='users'){b+='\"followme\":\"'+d.getElementById("followme").value+'\",'}b+='\"name\":\"'+d.getElementById("extname").value+'\",';b+='\"display\":\"'+d.getElementById("extdisplay").value+'\",';b+='\"login\":\"'+d.getElementById("extlogin").value+'\",';b+='\"password\":\"'+d.getElementById("extpassword").value+'\",';b+='\"pin\":\"'+d.getElementById("extpin").value+'\",';b+='\"features\":{';if(d.getElementById("fwdall")!=null){b+='\"fwdall\":'+d.getElementById("fwdall").checked+',';b+='\"fwdallnumber\":\"'+d.getElementById("fwdallnumber").value+'\",'}if(d.getElementById("fwdnregnumber")!=null){b+='\"fwdnreg\":'+d.getElementById("fwdnreg").checked+',';b+='\"fwdnregnumber\":\"'+d.getElementById("fwdnregnumber").value+'\",'}if(d.getElementById("fwdbusynumber")!=null){b+='\"fwdbusy\":'+d.getElementById("fwdbusy").checked+',';b+='\"fwdbusynumber\":\"'+d.getElementById("fwdbusynumber").value+'\",'}if(d.getElementById("fwdnansnumber")!=null){b+='\"fwdnans\":'+d.getElementById("fwdnans").checked+',';b+='\"fwdnansnumber\":\"'+d.getElementById("fwdnansnumber").value+'\",'}if(d.getElementById("fwdtimeout")!=null)b+='\"fwdtimeout\":'+d.getElementById("fwdtimeout").value+',';if(d.getElementById("plock").disabled==false)b+='\"lock\":'+d.getElementById("plock").checked+',';if(d.getElementById("dnd").disabled==false)b+='\"dnd\":'+d.getElementById("dnd").checked+',';if(d.getElementById("clir").disabled==false)b+='\"clir\":'+d.getElementById("clir").checked+',';if(d.getElementById("callwaiting").disabled==false)b+='\"callwaiting\":'+d.getElementById("callwaiting").checked+',';if(d.getElementById("pickupdeny").disabled==false)b+='\"pickupdeny\":'+d.getElementById("pickupdeny").checked+',';if(d.getElementById("monitordeny").disabled==false)b+='\"monitordeny\":'+d.getElementById("monitordeny").checked+',';if(d.getElementById("busyoverdeny").disabled==false)b+='\"busyoverdeny\":'+d.getElementById("busyoverdeny").checked+',';if(d.getElementById("recording").disabled==false)b+='\"recording\":'+d.getElementById("recording").checked+',';if(d.getElementById("voicemail").disabled==false)b+='\"voicemail\":'+d.getElementById("voicemail").checked+',';b+='}';json_rpc('setObject',b);$('#el-extension').modal('hide');update_extansions()}function fill_group_choice(a,b){var c=json_rpc('getObjects','\"kind\":\"'+a+'\"');var d,option,i;var e=document.getElementById("extgroup");for(i=0;i<c.length;i++){d=c[i].oid;option=document.createElement('option');option.setAttribute('value',d);if(d==b){option.selected="true"}option.innerHTML=c[i].name;e.appendChild(option)}}function update_extansions(a){var a=a||window.event;$('#extrefresh').addClass('spinner');json_rpc_async('getExtensions',null,update_extansions_);if(a)a.preventDefault()}function set_update_interval(a){var a=a||window.event;var b=document.getElementById('extrepeat');if(PbxObject.updext){clearInterval(PbxObject.updext);PbxObject.updext=false;if(b)b.className=''}else{PbxObject.updext=setInterval(function(){update_extansions()},5000);if(b)b.className='nav-active'}a.preventDefault()}function update_extansions_(a){var b,state,row,cells,status,table=document.getElementById('extensions');if(table){var c=table.getElementsByTagName('tbody')[0],trows=c.rows}else return;for(var i=0;i<a.length;i++){b=a[i];state=b.state;for(var j=0;j<trows.length;j++){row=trows[j];cells=row.cells;if(b.ext==row.getAttribute('data-ext')){if(state==0){status='Registered';row.className='success'}else if(state==3){status='Connected';row.className='connected'}else if(state==6){status='Forwarding';row.className='warning'}else if(state==5){status='';row.className=''}else if(state==4){status='Do not disturb';row.className='danger'}else if(state==1||state==2){status=state==1?'Dialing':'Ringing';row.className='info'}else{status='';row.className='active'}if(cells[1].innerHTML!=b.name){cells[1].innerHTML=b.name||""}if(cells[2].innerHTML!=b.group){cells[2].innerHTML=b.group}if(cells[3].innerHTML!=b.reg){cells[3].innerHTML=b.reg}if(cells[4].innerHTML!=b.kind){cells[4].innerHTML=b.kind}if(cells[5].innerHTML!=status){cells[5].innerHTML=status}if(state==-1&&!cells[6].children[0].getAttribute('disabled')){cells[6].children[0].setAttribute('disabled','disabled')}else if(state!=-1&&cells[6].children[0].getAttribute('disabled')){cells[6].children[0].removeAttribute('disabled')}}}}$('#extrefresh').removeClass('spinner')}function load_routes(a){PbxObject.oid=a.oid;PbxObject.kind='routes';PbxObject.routepriorities=["Max. prefix length","Least cost routing","Load balancing","Answer seizure ratio","Average call duration","Most idle gateway","Least utilised gateway","Max. priority (status)"];PbxObject.name=a.name;if(a.name){document.getElementById('objname').value=a.name}document.getElementById('enabled').checked=a.enabled;var i,ul=document.getElementById('priorities'),priorities=a.priorities;for(i=0;i<priorities.length;i++){var b=document.createElement('li');b.setAttribute('data-value',priorities[i]);b.innerHTML=PbxObject.routepriorities[priorities[i]];ul.appendChild(b)}var c=a.anumbertransforms;if(c.length){for(i=0;i<c.length;i++){append_transform(null,'transforms1',c[i])}}else{append_transform(null,'transforms1')}c=a.bnumbertransforms;if(c.length){for(i=0;i<c.length;i++){append_transform(null,'transforms2',c[i])}}else{append_transform(null,'transforms2')}if(a.routes!=undefined){build_routes_table(a.routes)}else{show_content()}set_page()}function set_routes(){var a=document.getElementById('objname').value;if(a)var b='\"name\":\"'+a+'\",';else{alert('Object name must be filled');return false}show_loading_panel();var c;if(PbxObject.name){c=set_object_success}else{PbxObject.name=a;c=set_new_object}if(PbxObject.oid)b+='\"oid\":\"'+PbxObject.oid+'\",';b+='\"kind\":\"routes\",';b+='\"enabled\":'+document.getElementById('enabled').checked+',';b+='\"priorities\":[';var d=document.getElementById('priorities');var i,j;for(i=0;i<d.children.length;i++){b+=d.children[i].getAttribute('data-value')+','}b+='],';b+='\"anumbertransforms\":[';b+=encode_transforms('transforms1');b+='],';b+='\"bnumbertransforms\":[';b+=encode_transforms('transforms2');b+='],';b+='\"routes\":[';var e,a,row,els,inp,table=document.getElementById('rtable');for(i=1;i<table.rows.length;i++){row=table.rows[i];els=row.getElementsByClassName('form-group');e='';for(j=0;j<els.length;j++){inp=els[j].firstChild;a=inp.getAttribute('name');if(a=='number'){if(inp.value)e+='"number":"'+inp.value+'",';else break}else if(a=='description'){e+='"description":"'+inp.value+'",'}else if(a=='target'){e+='"target":{"oid":"'+inp.value+'"},'}else if(a=='priority'){e+='"priority":'+inp.value+','}else if(a=='cost'){e+='"cost":'+inp.value+','}}if(e!='')b+='{'+e+'},'}b+=']';json_rpc_async('setObject',b,c)}function build_routes_table(a){var b=json_rpc('getObjects','\"kind\":\"all\"');var c=document.getElementById("rtable").getElementsByTagName('tbody')[0];for(var i=0;i<a.length;i++){c.appendChild(build_route_row(a[i],b))}c.appendChild(build_route_row(null,b));show_content()}function add_route(){var a=json_rpc('getObjects','\"kind\":\"all\"');var b=document.getElementById("rtable").getElementsByTagName('tbody')[0];b.appendChild(build_route_row(null,a))}function build_route_row(a,b){var c=document.createElement('tr');var d=document.createElement('td');var e=document.createElement('div');e.className='form-group';var f=document.createElement('input');f.className='form-control';f.setAttribute('type','text');f.setAttribute('name','number');f.setAttribute('size','12');if(a!=null){f.setAttribute('value',a.number)}e.appendChild(f);d.appendChild(e);c.appendChild(d);d=document.createElement('td');var e=document.createElement('div');e.className='form-group';f=document.createElement('input');f.className='form-control';f.setAttribute('type','text');f.setAttribute('name','description');if(a!=null){f.setAttribute('value',a.description)}e.appendChild(f);d.appendChild(e);c.appendChild(d);d=document.createElement('td');var e=document.createElement('div');e.className='form-group';f=document.createElement('select');f.setAttribute('name','target');var i;for(i=0;i<b.length;i++){var g=b[i].kind;if(g=='equipment'||g=='cli'||g=='timer'||g=='routes'||g=='users'||g=='pickup'){continue}var h=b[i].oid;var j=document.createElement('option');j.setAttribute('value',h);if(a!=null&&h==a.target.oid){j.setAttribute('selected','')}j.innerHTML=b[i].name;f.appendChild(j)}e.appendChild(f);d.appendChild(e);c.appendChild(d);d=document.createElement('td');var e=document.createElement('div');e.className='form-group';f=document.createElement('select');f.setAttribute('name','priority');for(i=0;i<10;i++){var j=document.createElement('option');j.setAttribute('value',i);if(a!=null&&i==a.priority){j.setAttribute('selected','')}if(i==0){j.innerHTML='OFF'}else if(i==9){j.innerHTML='EXV'}else j.innerHTML=i;f.appendChild(j)}e.appendChild(f);d.appendChild(e);c.appendChild(d);d=document.createElement('td');var e=document.createElement('div');e.className='form-group';f=document.createElement('input');f.className='form-control';f.setAttribute('type','text');f.setAttribute('name','cost');f.setAttribute('size','4');f.setAttribute('value',a!=null?a.cost:'0');e.appendChild(f);d.appendChild(e);c.appendChild(d);if(a!=null&&a.huntstop!=undefined){d=document.createElement('td');f=document.createElement('input');f.setAttribute('type','checkbox');f.setAttribute('name','huntstop');if(a.huntstop)f.setAttribute('checked',a.huntstop);d.appendChild(f);c.appendChild(d)}d=document.createElement('td');f=document.createElement('input');f.setAttribute('type','checkbox');f.className='delall';addEvent(f,'change',function(){change_handler('rtable')});d.setAttribute('align','center');d.appendChild(f);c.appendChild(d);return c}function load_timer(a){PbxObject.oid=a.oid;PbxObject.name=a.name;PbxObject.kind='timer';if(a.name){document.getElementById('objname').value=a.name}document.getElementById('enabled').checked=a.enabled;var i;var b=document.getElementById('hh');for(i=0;i<24;i++){var c=document.createElement('option');if(i<10)var d='0'+i;else d=i;c.value=d;c.innerHTML=d;b.appendChild(c);if(d==a.hour){b.selectedIndex=i}}var e=document.getElementById('mm');for(i=0;i<=55;i+=5){var c=document.createElement('option');if(i<10)var d='0'+i;else d=i;c.value=d;c.innerHTML=d;e.appendChild(c);if(d==a.minute){e.selectedIndex=i/5}}for(i=0;i<a.weekdays.length;i++){document.getElementById('d'+a.weekdays[i]).checked=true}fill_timer_targets('objects');var f=document.getElementById('targets').getElementsByTagName('tbody')[0];for(i=0;i<a.targets.length;i++){f.appendChild(timer_target_row(a.targets[i].oid,a.targets[i].name,a.targets[i].action))}show_content();set_page();var g=document.getElementById('add-timer-target');g.onclick=function(){add_timer_target()};var h=document.getElementById('timer-everyday');addEvent(h,'click',check_days);var j=document.getElementById('timer-workdays');addEvent(j,'click',check_days);var k=document.getElementById('timer-holidays');addEvent(k,'click',check_days)}function set_timer(){var a,name=document.getElementById('objname').value;if(name)a='\"name\":\"'+name+'\",';else{alert('Object name must be filled');return false}show_loading_panel();var b;if(PbxObject.name){b=set_object_success}else{PbxObject.name=name;b=set_new_object}if(PbxObject.oid!=null){a+='\"oid\":\"'+PbxObject.oid+'\",'}a+='\"kind\":\"timer\",';var c=document.getElementById('enabled');if(c!=null){a+='\"enabled\":'+c.checked+','}var h=document.getElementById('hh');var m=document.getElementById('mm');a+='\"hour\":\"'+h.options[h.selectedIndex].value+'\",';a+='\"minute\":\"'+m.options[m.selectedIndex].value+'\",';a+='\"weekdays\":[';var i;for(i=0;i<7;i++){if(document.getElementById('d'+i).checked){a+=i+','}}a+='],';var d=document.getElementById('targets').getElementsByTagName('tbody')[0];a+='\"targets\":[';for(i=0;i<d.children.length;i++){var e=d.children[i];if(e.id!=undefined&&e.id!=''){a+='{\"oid\":\"'+d.children[i].id+'\",\"action\":\"'+e.children[1].innerHTML+'\"},'}}a+=']';json_rpc_async('setObject',a,b)}function timer_target_row(b,c,d){var f=document.createElement('tr');f.id=b;var g=document.createElement('td');var a=document.createElement('a');a.href='#';a.onclick=function(e){get_object_link(b);e.preventDefault()};a.innerHTML=c;g.appendChild(a);f.appendChild(g);g=document.createElement('td');g.innerHTML=d;f.appendChild(g);g=document.createElement('td');var h=document.createElement('button');h.className='btn btn-danger btn-sm';h.innerHTML='Del';h.onclick=function(){remove_listener(b)};g.appendChild(h);f.appendChild(g);return f}function add_timer_target(){var a=document.getElementsByTagName('tbody')[0];var b=document.getElementById('objects');var c=document.getElementById('actions');var d=b.options[b.selectedIndex];a.appendChild(timer_target_row(d.value,d.innerHTML,c.value))}function remove_listener(a){var b=document.getElementById('targets').getElementsByTagName('tbody')[0];var i;for(i=0;i<b.children.length;i++){if(b.children[i].id==a){b.removeChild(b.children[i])}}}function fill_timer_targets(a){var b=document.getElementById(a);var c=json_rpc('getObjects','\"kind\":\"all\"');for(var i=0;i<c.length;i++){var d=c[i].kind;if(d=='equipment'||d=='cli'||d=='timer'||d=='users'){continue}var e=c[i].oid;var f=document.createElement('option');f.value=e;f.innerHTML=c[i].name;b.appendChild(f)}}function check_days(){var i,day,id=this.id;for(i=0;i<7;i++){day=document.getElementById('d'+i);if((id==='timer-workdays'&&(i===5||i===6))||(id==='timer-holidays'&&i<5)){if(day.checked)day.checked=false;continue}day.checked=true}}function load_trunk(d){PbxObject.oid=d.oid;PbxObject.name=d.name;PbxObject.kind='trunk';if(d.name)document.getElementById('objname').value=d.name;document.getElementById('enabled').checked=d.enabled;if(d.status)document.getElementById('status').innerHTML=d.status;if(d.protocol)document.getElementById('protocol').value=d.protocol;if(d.domain)document.getElementById('domain').value=d.domain;document.getElementById('register').checked=d.register;if(d.user)document.getElementById('user').value=d.user;if(d.auth)document.getElementById('auth').value=d.auth;if(d.pass)document.getElementById('pass').value=d.pass;document.getElementById('regexpires').value=d.regexpires||60;var e=document.getElementById('proxy');addEvent(e,'change',function(){var a=document.getElementsByName(this.id);if(this.checked)var b=false;else b=true;for(var i=0;i<a.length;i++){a[i].disabled=b}});e.checked=d.proxy;if(d.paddr)document.getElementById('paddr').value=d.paddr;if(d.pauth)document.getElementById('pauth').value=d.pauth;if(d.ppass)document.getElementById('ppass').value=d.ppass;if(d.maxinbounds!=undefined){document.getElementById('maxinbounds').value=d.maxinbounds;document.getElementById('inmode').checked=d.maxinbounds>0}if(d.maxoutbounds!=undefined){document.getElementById('maxoutbounds').value=d.maxoutbounds;document.getElementById('outmode').checked=d.maxoutbounds>0}if(d.parameters!=undefined){var f=d.parameters.codecs;if(f!=undefined){var c;for(var i=0;i<f.length;i++){c=document.getElementById('c'+i);if(!c)break;c.value=f[i].codec;document.getElementById('f'+i).value=f[i].frame}}else{for(i=0;i<4;i++){document.getElementById('c'+i).selectedIndex=0;document.getElementById('f'+i).value=0}}if(d.parameters.t1)document.getElementById('t1').value=d.parameters.t1||5;if(d.parameters.t2)document.getElementById('t2').value=d.parameters.t2||15;if(d.parameters.t3)document.getElementById('t3').value=d.parameters.t3||5;if(d.parameters.t38fax)document.getElementById('t38fax').checked=d.parameters.t38fax;if(d.parameters.video)document.getElementById('video').checked=d.parameters.video;if(d.parameters.dtmfrelay)document.getElementById('dtmfrelay').checked=d.parameters.dtmfrelay;if(d.parameters.earlymedia)document.getElementById('earlymedia').checked=d.parameters.earlymedia;if(d.protocol=='h323'){document.getElementById('sip').parentNode.style.display='none';if(d.parameters.dtmfmode)document.getElementById('dtmfh323').value=d.parameters.dtmfmode;if(d.parameters.faststart)document.getElementById('faststart').checked=d.parameters.faststart;if(d.parameters.h245tunneling)document.getElementById('h245tunneling').checked=d.parameters.h245tunneling;if(d.parameters.playringback)document.getElementById('playringback').checked=d.parameters.playringback}else{document.getElementById('h323').parentNode.style.display='none';if(d.parameters.dtmfmode)document.getElementById('dtmfsip').value=d.parameters.dtmfmode}}var g=d.inboundanumbertransforms;if(g.length){for(i=0;i<g.length;i++){append_transform(null,'transforms1',g[i])}}else{append_transform(null,'transforms1')}g=d.inboundbnumbertransforms;if(g.length){for(i=0;i<g.length;i++){append_transform(null,'transforms2',g[i])}}else{append_transform(null,'transforms2')}g=d.outboundanumbertransforms;if(g.length){for(i=0;i<g.length;i++){append_transform(null,'transforms3',g[i])}}else{append_transform(null,'transforms3')}g=d.outboundbnumbertransforms;if(g.length){for(i=0;i<g.length;i++){append_transform(null,'transforms4',g[i])}}else{append_transform(null,'transforms4')}var h=document.getElementById('protocol');h.onchange=change_protocol;show_content();set_page()}function set_trunk(){var a=document.getElementById('objname').value;var b;if(a)b='"name":"'+a+'",';else{alert('Object name must be filled');return false}show_loading_panel();var c;if(PbxObject.oid)b+='"oid":"'+PbxObject.oid+'",';if(PbxObject.name){c=set_object_success}else{PbxObject.name=a;c=set_new_object}b+='"kind":"trunk",';b+='"enabled":'+document.getElementById('enabled').checked+',';var d=document.getElementById('protocol').value;b+='"protocol":"'+d+'",';b+='"domain":"'+document.getElementById('domain').value+'",';b+='"register":'+document.getElementById('register').checked+',';b+='"user":"'+document.getElementById('user').value+'",';b+='"auth":"'+document.getElementById('auth').value+'",';b+='"pass":"'+document.getElementById('pass').value+'",';b+='"proxy":'+document.getElementById('proxy').checked+',';b+='"paddr":"'+document.getElementById('paddr').value+'",';b+='"pauth":"'+document.getElementById('pauth').value+'",';b+='"ppass":"'+document.getElementById('ppass').value+'",';if(document.getElementById('inmode').checked)b+='"maxinbounds":'+document.getElementById('maxinbounds').value+',';else b+='"maxinbounds":0,';if(document.getElementById('outmode').checked)b+='"maxoutbounds":'+document.getElementById('maxoutbounds').value+',';else b+='"maxoutbounds":0,';b+='"parameters":{';if(document.getElementById('codecs')){b+='"codecs":[';for(var i=0;i<4;i++){if(document.getElementById('c'+i).selectedIndex==0)break;b+='{"codec":"'+document.getElementById('c'+i).value+'",';b+='"frame":'+document.getElementById('f'+i).value+'},'}b+='],'}if(document.getElementById('t1'))b+='"t1":'+document.getElementById('t1').value+',';if(document.getElementById('t2'))b+='"t2":'+document.getElementById('t2').value+',';if(document.getElementById('t3'))b+='"t3":'+document.getElementById('t3').value+',';if(document.getElementById('regexpires'))b+='"regexpires":'+document.getElementById('regexpires').value+',';if(document.getElementById('t38fax'))b+='"t38fax":'+document.getElementById('t38fax').checked+',';if(document.getElementById('video'))b+='"video":'+document.getElementById('video').checked+',';if(document.getElementById('earlymedia'))b+='"earlymedia":'+document.getElementById('earlymedia').checked+',';if(document.getElementById('dtmfrelay'))b+='"dtmfrelay":'+document.getElementById('dtmfrelay').checked+',';if(d=='h323'){b+='"dtmfmode":"'+document.getElementById('dtmfh323').value+'",';b+='"faststart":'+document.getElementById('faststart').checked+',';b+='"h245tunneling":'+document.getElementById('h245tunneling').checked+',';b+='"playringback":'+document.getElementById('playringback').checked+','}else{b+='"dtmfmode":"'+document.getElementById('dtmfsip').value+'",'}b+='},';b+='"inboundbnumbertransforms":[';b+=encode_transforms('transforms1');b+='],';b+='"inboundanumbertransforms":[';b+=encode_transforms('transforms2');b+='],';b+='"outboundbnumbertransforms":[';b+=encode_transforms('transforms3');b+='],';b+='"outboundanumbertransforms":[';b+=encode_transforms('transforms4');b+=']';json_rpc_async('setObject',b,c)};function change_protocol(){var a=this.value;if(a=='h323'){document.getElementById('sip').parentNode.style.display='none';document.getElementById('h323').parentNode.style.display=''}else{document.getElementById('sip').parentNode.style.display='';document.getElementById('h323').parentNode.style.display='none'}};